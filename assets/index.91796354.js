var B=Object.defineProperty,G=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var q=(u,a,o)=>a in u?B(u,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[a]=o,E=(u,a)=>{for(var o in a||(a={}))D.call(a,o)&&q(u,o,a[o]);if(N)for(var o of N(a))H.call(a,o)&&q(u,o,a[o]);return u},R=(u,a)=>G(u,Y(a));import{h as W,F as J,a as A,v as K,E as U,b as Z}from"./validate.adeb755f.js";import{g as ee,b as te,L as ne,m as oe,r as F,c as j,d as se,e as ie,f as ae,h as re,j as ce}from"./index.816317c1.js";import{h as X,r as T,o as L,c as S,f as w,a as b,j as le,v as de,Y as ue,L as pe,g as O,I as C,w as V,i as he,A as me,E as fe}from"./vendor.6a4b3e84.js";(function(){function u(e){var i=document.getElementById(e.id),t=typeof e=="object"&&e;return new l(i,t)}var a=function(){var e=arguments.length,i=arguments[0]||{},t,r,d;for(typeof i!="object"&&typeof i!="function"&&(i={}),e==1&&(i=this,t--),t=1;t<e;t++){r=arguments[t];for(d in r)Object.prototype.hasOwnProperty.call(r,d)&&(i[d]=r[d])}return i},o=function(e){return typeof e=="function"&&typeof e.nodeType!="number"},l=function(e,i){this.$element=e,this.options=a({},l.DEFAULTS,i),this.$element.style.position="relative",this.$element.style.width=this.options.width+"px",this.$element.style.margin="0 auto",this.init()},f;l.VERSION="1.0",l.Author="imooc_front@163.com",l.DEFAULTS={width:280,height:155,PI:Math.PI,sliderL:42,sliderR:9,offset:5,loadingText:"\u6B63\u5728\u52A0\u8F7D\u4E2D...",failedText:"\u518D\u8BD5\u4E00\u6B21",barText:"\u5411\u53F3\u6ED1\u52A8\u586B\u5145\u62FC\u56FE",repeatIcon:"iconfont iconfont-shuaxin",maxLoadCount:3,localImages:function(){return"images/Pic"+Math.round(Math.random()*4)+".jpg"},verify:function(e,i){var t=!1;return $.ajax({url:i,data:{datas:JSON.stringify(e)},dataType:"json",type:"post",async:!1,success:function(r){t=JSON.stringify(r),console.log("\u8FD4\u56DE\u7ED3\u679C\uFF1A"+t)}}),t},remoteUrl:""},window.sliderCaptcha=u,window.sliderCaptcha.Constructor=l,f=l.prototype,f.init=function(){this.initDOM(),this.initImg(),this.bindEvents()},f.initDOM=function(){var e=function(v,z){var k=document.createElement(v);return k.className=z,k},i=function(v,z){var k=document.createElement("canvas");return k.width=v,k.height=z,k},t=i(this.options.width-2,this.options.height),r=t.cloneNode(!0),d=e("div","sliderContainer"),p=e("i","refreshIcon "+this.options.repeatIcon),c=e("div","sliderMask"),s=e("div","sliderbg"),n=e("div","slider"),h=e("i","iconfont icon-arrow-right sliderIcon"),m=e("span","sliderText"),x,g;r.className="slider-captcha-block",m.innerHTML=this.options.barText,x=this.$element,x.appendChild(t),x.appendChild(p),x.appendChild(r),n.appendChild(h),c.appendChild(n),d.appendChild(s),d.appendChild(c),d.appendChild(m),x.appendChild(d),g={canvas:t,block:r,sliderContainer:d,refreshIcon:p,slider:n,sliderMask:c,sliderIcon:h,text:m,canvasCtx:t.getContext("2d"),blockCtx:r.getContext("2d")},o(Object.assign)?Object.assign(this,g):a(this,g)},f.initImg=function(){var e=this,i=window.navigator.userAgent.indexOf("Trident")>-1,t=this.options.sliderL+this.options.sliderR*2+3,r=function(s,n){var h=e.options.sliderL,m=e.options.sliderR,x=e.options.PI,g=e.x,v=e.y;s.beginPath(),s.moveTo(g,v),s.arc(g+h/2,v-m+2,m,.72*x,2.26*x),s.lineTo(g+h,v),s.arc(g+h+m-2,v+h/2,m,1.21*x,2.78*x),s.lineTo(g+h,v+h),s.lineTo(g,v+h),s.arc(g+m-2,v+h/2,m+.4,2.76*x,1.24*x,!0),s.lineTo(g,v),s.lineWidth=2,s.fillStyle="rgba(255, 255, 255, 0.7)",s.strokeStyle="rgba(255, 255, 255, 0.7)",s.stroke(),s[n](),s.globalCompositeOperation=i?"xor":"destination-over"},d=function(s,n){return Math.round(Math.random()*(n-s)+s)},p=new Image,c;p.crossOrigin="Anonymous",c=0,p.onload=function(){e.x=d(t+10,e.options.width-(t+10)),e.y=d(10+e.options.sliderR*2,e.options.height-(t+10)),r(e.canvasCtx,"fill"),r(e.blockCtx,"clip"),e.canvasCtx.drawImage(p,0,0,e.options.width-2,e.options.height),e.blockCtx.drawImage(p,0,0,e.options.width-2,e.options.height);var s=e.y-e.options.sliderR*2-1,n=e.blockCtx.getImageData(e.x-3,s,t,t);e.block.width=t,e.blockCtx.putImageData(n,0,s+1),e.text.textContent=e.text.getAttribute("data-text")},p.onerror=function(){if(c++,window.location.protocol==="file:"&&(c=e.options.maxLoadCount,console.error("can't load pic resource file from File protocal. Please try http or https")),c>=e.options.maxLoadCount){e.text.textContent="\u52A0\u8F7D\u5931\u8D25",e.classList.add("text-danger");return}p.src=e.options.localImages()},p.setSrc=function(){var s="",n;c=0,e.text.classList.remove("text-danger"),o(e.options.setSrc)&&(s=e.options.setSrc()),s&&s!==""||(s="https://picsum.photos/"+e.options.width+"/"+e.options.height+"/?image="+Math.round(Math.random()*200)),i?(n=new XMLHttpRequest,n.onloadend=function(h){var m=new FileReader;m.readAsDataURL(h.target.response),m.onloadend=function(x){p.src=x.target.result}},n.open("GET",s),n.responseType="blob",n.send()):p.src=s},p.setSrc(),this.text.setAttribute("data-text",this.options.barText),this.text.textContent=this.options.loadingText,this.img=p},f.clean=function(){this.canvasCtx.clearRect(0,0,this.options.width,this.options.height),this.blockCtx.clearRect(0,0,this.options.width,this.options.height),this.block.width=this.options.width},f.bindEvents=function(){var e=this;this.$element.addEventListener("selectstart",function(){return!1}),this.refreshIcon.addEventListener("click",function(){e.text.textContent=e.options.barText,e.reset(),o(e.options.onRefresh)&&e.options.onRefresh.call(e.$element)});var i,t,r=[],d=!1,p=function(n){e.text.classList.contains("text-danger")||(i=n.clientX||n.touches[0].clientX,t=n.clientY||n.touches[0].clientY,d=!0)},c=function(n){var h;if(!d)return!1;var m=n.clientX||n.touches[0].clientX,x=n.clientY||n.touches[0].clientY,g=m-i,v=x-t;if(g<0||g+40>e.options.width)return!1;e.slider.style.left=g-1+"px",h=(e.options.width-60)/(e.options.width-40)*g,e.block.style.left=h+"px",e.sliderContainer.classList.add("sliderContainer_active"),e.sliderMask.style.width=g+4+"px",r.push(Math.round(v))},s=function(n){var h,m;if(!d||(d=!1,h=n.clientX||n.changedTouches[0].clientX,h===i))return!1;e.sliderContainer.classList.remove("sliderContainer_active"),e.trail=r,m=e.verify(),m.spliced&&m.verified?(e.sliderContainer.classList.add("sliderContainer_success"),o(e.options.onSuccess)&&e.options.onSuccess.call(e.$element,r)):(e.sliderContainer.classList.add("sliderContainer_fail"),o(e.options.onFail)&&e.options.onFail.call(e.$element),setTimeout(function(){e.text.innerHTML=e.options.failedText,e.reset()},1e3))};this.slider.addEventListener("mousedown",p),this.slider.addEventListener("touchstart",p),document.addEventListener("mousemove",c),document.addEventListener("touchmove",c),document.addEventListener("mouseup",s),document.addEventListener("touchend",s),document.addEventListener("mousedown",function(){return!1}),document.addEventListener("touchstart",function(){return!1}),document.addEventListener("swipe",function(){return!1})},f.verify=function(){var e=this.trail,i=parseInt(this.block.style.left),t=!1;if(this.options.remoteUrl!==null)t=this.options.verify(e,this.options.remoteUrl);else{var r=function(n,h){return n+h},d=function(n){return n*n},p=e.reduce(r)/e.length,c=e.map(function(n){return n-p}),s=Math.sqrt(c.map(d).reduce(r)/e.length);t=s!==0}return{spliced:Math.abs(i-this.x)<this.options.offset,verified:t}},f.reset=function(){this.sliderContainer.classList.remove("sliderContainer_fail"),this.sliderContainer.classList.remove("sliderContainer_success"),this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.text.setAttribute("data-text",this.text.textContent),this.text.textContent=this.options.loadingText,this.img.setSrc()}})();const ge={class:"fixed top-[20%] left-[50%] translate-x-[-50%] w-[340px] h-[270px] text-sm bg-white dark:bg-zinc-800 rounded border border-zinc-200 dark:border-zinc-900 shadow-3xl"},xe={class:"flex items-center h-5 text-left px-1 mb-1"},P="close",Q="success",ve={__name:"slider-captcha",emits:[P,Q],setup(u,{emit:a}){const o=a;let l=null;X(()=>{l=sliderCaptcha({id:"captcha",async onSuccess(i){await ee({behavior:i})&&o(Q)},onFail(){console.log("onFail")},verify(){return!0}})});const f=()=>{l.reset()},e=()=>{o(P)};return(i,t)=>{const r=T("m-svg-icon");return L(),S("div",ge,[w("div",xe,[t[0]||(t[0]=w("span",{class:"flex-grow dark:text-zinc-200"},"\u8BF7\u5B8C\u6210\u5B89\u5168\u9A8C\u8BC1",-1)),b(r,{name:"refresh",fillClass:"fill-zinc-900 dark:fill-zinc-200",class:"w-3 h-3 p-0.5 rounded-sm duration-300 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900",onClick:f}),b(r,{name:"close",fillClass:"fill-zinc-900 dark:fill-zinc-200",class:"ml-2 w-3 h-3 p-0.5 rounded-sm duration-300 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900",onClick:e})]),t[1]||(t[1]=w("div",{id:"captcha"},null,-1))])}}},I="LOGIN_SUCCESS_CHANNEL";let _=null;window.BroadcastChannel&&(_=new BroadcastChannel(I));const be=()=>new Promise((u,a)=>{_?_.onmessage=async o=>{u(o.data)}:window.onstorage=o=>{o.key===I&&u(JSON.parse(o.newValue))}}),we=u=>{_?_.postMessage(u):localStorage.setItem(I,JSON.stringify(u))},_e=()=>{_&&(_.close(),_=null),localStorage.removeItem(I)};var y={wait:be,send:we,clear:_e};const M=async(u,a)=>{if(await te.dispatch("user/login",E({loginType:u},a))===ne){oe("success",`\u6B22\u8FCE\u60A8 ${a.nickname}\uFF0C\u8BF7\u521B\u5EFA\u60A8\u7684\u8D26\u53F7`,6e3),F.push({path:"/register",query:E({reqType:u},a)});return}F.push("/")},Ce={id:"qqLoginBtn"},ke="https://graph.qq.com/oauth2.0/authorize?client_id=101998494&response_type=token&scope=all&redirect_uri=https%3A%2F%2Fimooc-front.lgdsunday.club%2Flogin",ye={__name:"qq-login",setup(u){X(()=>{QC.Login({btnId:"qqLoginBtn"},(l,f)=>{console.log("QQ\u767B\u5F55\u6210\u529F"),QC.Login.signOut();const e=/access_token=((.*))&expires_in/.exec(window.location.hash)[1],i={nickname:l.nickname,figureurl_qq_2:l.figureurl_qq_2,accessToken:e};y.send(i),M(j,i),window.close()})});const a=()=>{o()},o=async()=>{window.open(ke,"oauth2Login_10609","height=525,width=585, toolbar=no, menubar=no, scrollbars=no, status=no, location=yes, resizable=yes"),y.wait().then(async l=>{y.clear(),M(j,l)})};return(l,f)=>{const e=T("m-svg-icon");return L(),S("div",null,[le(w("span",Ce,null,512),[[de,!1]]),b(e,{class:"w-4 cursor-pointer",name:"qq",onClick:a})])}}},Le={__name:"weixin-login",setup(u){if(window.location.search){const o=/code=((.*))&state/.exec(window.location.search)[1];o&&(y.send({code:o}),window.close())}const a=async()=>{const{appId:o,appSecret:l,redirectUri:f,scope:e,state:i}=await se();window.open(`https://open.weixin.qq.com/connect/qrconnect?appid=${o}&redirect_uri=${f}&response_type=code&scope=${e}&state=${i}#wechat_redirect`,"","height=525,width=585, toolbar=no, menubar=no, scrollbars=no, status=no, location=yes, resizable=yes"),y.wait().then(async({code:t})=>{console.log("\u5FAE\u4FE1\u626B\u7801\u767B\u5F55\u6210\u529F"),console.log(t),y.clear();const{access_token:r,openid:d}=await ie(o,l,t);console.log("access_token, openid"),console.log(r,d);const{nickname:p,headimgurl:c}=await ae(r,d);console.log(p,c),M(re,{openid:d,nickname:p,headimgurl:c})})};return(o,l)=>{const f=T("m-svg-icon");return L(),S("div",{onClick:a},[b(f,{class:"w-4 cursor-pointer",name:"wexin"}),l[0]||(l[0]=w("div",{id:"login_container"},null,-1))])}}},Ee={class:"relative h-screen bg-white dark:bg-zinc-800 text-center xl:bg-zinc-200"},Te={class:"block px-3 mt-4 dark:bg-zinc-800 xl:bg-white xl:w-[388px] xl:dark:bg-zinc-900 xl:m-auto xl:mt-8 xl:py-4 xl:rounded-sm xl:shadow-lg"},Se={class:"flex justify-around mt-4"},Ie={name:"login"},$e=Object.assign(Ie,{setup(u){const a=ue(),o=pe(),l=O(!1),f=()=>{l.value=!0},e=async()=>{l.value=!1,r()},i=O(!1),t=O({username:"imooc",password:"123456"}),r=async()=>{i.value=!0;try{await a.dispatch("user/login",R(E({},t.value),{loginType:ce}))}finally{i.value=!1}o.push("/")},d=()=>{a.commit("app/changeRouterType","push"),o.push("/register")};return(p,c)=>{const s=T("m-button");return L(),S("div",Ee,[b(W),w("div",Te,[c[4]||(c[4]=w("h3",{class:"mb-2 font-semibold text-base text-main dark:text-zinc-300 hidden xl:block"}," \u8D26\u53F7\u767B\u5F55 ",-1)),b(C(J),{onSubmit:f},{default:V(()=>[b(C(A),{class:"dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b-[1px] w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:dark:bg-zinc-900",name:"username",rules:C(K),type:"text",placeholder:"\u7528\u6237\u540D",autocomplete:"on",modelValue:t.value.username,"onUpdate:modelValue":c[0]||(c[0]=n=>t.value.username=n)},null,8,["rules","modelValue"]),b(C(U),{class:"text-sm text-red-600 block mt-0.5 text-left",name:"username"}),b(C(A),{class:"dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b-[1px] w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:dark:bg-zinc-900",name:"password",rules:C(Z),type:"password",placeholder:"\u5BC6\u7801",autocomplete:"on",modelValue:t.value.password,"onUpdate:modelValue":c[1]||(c[1]=n=>t.value.password=n)},null,8,["rules","modelValue"]),b(C(U),{class:"text-sm text-red-600 block mt-0.5 text-left",name:"password"}),w("div",{class:"pt-1 pb-3 leading-[0px] text-right"},[w("a",{class:"inline-block p-1 text-zinc-400 text-right dark:text-zinc-600 hover:text-zinc-600 dark:hover:text-zinc-400 text-sm duration-400 cursor-pointer",onClick:d}," \u53BB\u6CE8\u518C ")]),b(s,{class:"w-full dark:bg-zinc-900 xl:dark:bg-zinc-800",loading:i.value,isActiveAnim:!1},{default:V(()=>c[3]||(c[3]=[fe(" \u767B\u5F55 ")])),_:1},8,["loading"])]),_:1}),w("div",Se,[b(ye),b(Le)])]),l.value?(L(),he(ve,{key:0,onClose:c[2]||(c[2]=n=>l.value=!1),onSuccess:e})):me("",!0)])}}});export{$e as default};
